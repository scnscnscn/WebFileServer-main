# Modern C++ Web File Server

ä¸€ä¸ªä½¿ç”¨ç°ä»£C++17æ ‡å‡†å®ç°çš„é«˜æ€§èƒ½Webæ–‡ä»¶æœåŠ¡å™¨ï¼Œæ”¯æŒæ–‡ä»¶ä¸Šä¼ ã€ä¸‹è½½ã€åˆ é™¤å’Œåˆ—è¡¨å±•ç¤ºåŠŸèƒ½ã€‚

## ğŸš€ ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½
- **æ–‡ä»¶ç®¡ç†**: æ”¯æŒæ–‡ä»¶ä¸Šä¼ ã€ä¸‹è½½ã€åˆ é™¤å’Œåˆ—è¡¨å±•ç¤º
- **HTTPåè®®**: å®Œæ•´çš„HTTP/1.1åè®®æ”¯æŒ
- **å¤šçº¿ç¨‹**: åŸºäºçº¿ç¨‹æ± çš„å¹¶å‘å¤„ç†
- **äº‹ä»¶é©±åŠ¨**: ä½¿ç”¨epollçš„é«˜æ€§èƒ½I/Oå¤šè·¯å¤ç”¨
- **é›¶æ‹·è´**: ä½¿ç”¨sendfileå®ç°é«˜æ•ˆæ–‡ä»¶ä¼ è¾“

### ç°ä»£C++ç‰¹æ€§
- **C++17æ ‡å‡†**: ä½¿ç”¨ç°ä»£C++è¯­è¨€ç‰¹æ€§
- **RAIIè®¾è®¡**: è‡ªåŠ¨èµ„æºç®¡ç†ï¼Œå¼‚å¸¸å®‰å…¨
- **æ™ºèƒ½æŒ‡é’ˆ**: å†…å­˜å®‰å…¨ï¼Œé¿å…å†…å­˜æ³„æ¼
- **å¼‚æ­¥æ—¥å¿—**: é«˜æ€§èƒ½çš„å¼‚æ­¥æ—¥å¿—ç³»ç»Ÿ
- **é…ç½®åŒ–**: æ”¯æŒé…ç½®æ–‡ä»¶å’Œå‘½ä»¤è¡Œå‚æ•°

### æ€§èƒ½ä¼˜åŒ–
- **Reactoræ¨¡å¼**: äº‹ä»¶é©±åŠ¨çš„ç½‘ç»œç¼–ç¨‹æ¨¡å¼
- **è¿æ¥æ± **: é«˜æ•ˆçš„è¿æ¥ç®¡ç†
- **éé˜»å¡I/O**: é¿å…çº¿ç¨‹é˜»å¡
- **è¾¹ç¼˜è§¦å‘**: epollè¾¹ç¼˜è§¦å‘æ¨¡å¼
- **ä¼˜é›…å…³é—­**: æ”¯æŒä¼˜é›…çš„æœåŠ¡å™¨å…³é—­

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

- **æ“ä½œç³»ç»Ÿ**: Linux (å†…æ ¸ç‰ˆæœ¬ >= 2.6)
- **ç¼–è¯‘å™¨**: GCC >= 7.0 æˆ– Clang >= 5.0 (æ”¯æŒC++17)
- **CMake**: >= 3.12
- **å†…å­˜**: å»ºè®® >= 512MB
- **ç£ç›˜**: æ ¹æ®æ–‡ä»¶å­˜å‚¨éœ€æ±‚

## ğŸ› ï¸ ç¼–è¯‘å®‰è£…

### ä½¿ç”¨CMakeç¼–è¯‘

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/your-repo/WebFileServer.git
cd WebFileServer

# åˆ›å»ºæ„å»ºç›®å½•
mkdir build && cd build

# é…ç½®é¡¹ç›®
cmake .. -DCMAKE_BUILD_TYPE=Release

# ç¼–è¯‘
make -j$(nproc)

# å®‰è£…ï¼ˆå¯é€‰ï¼‰
sudo make install
```

### ä½¿ç”¨ä¼ ç»ŸMakefileç¼–è¯‘

```bash
# ç›´æ¥ç¼–è¯‘
make

# æ¸…ç†
make clean
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### åŸºæœ¬ä½¿ç”¨

```bash
# ä½¿ç”¨é»˜è®¤é…ç½®å¯åŠ¨æœåŠ¡å™¨
./WebFileServer

# æŒ‡å®šç«¯å£å¯åŠ¨
./WebFileServer --port 9000

# æŒ‡å®šçº¿ç¨‹æ•°
./WebFileServer --threads 8

# æŒ‡å®šæ–‡æ¡£æ ¹ç›®å½•
./WebFileServer --document-root /path/to/files
```

### å‘½ä»¤è¡Œå‚æ•°

```bash
Usage: WebFileServer [options]
Options:
  -p, --port <port>        ç›‘å¬ç«¯å£ (é»˜è®¤: 8888)
  -t, --threads <count>    çº¿ç¨‹æ± å¤§å° (é»˜è®¤: CPUæ ¸å¿ƒæ•°)
  -d, --document-root <path>  æ–‡æ¡£æ ¹ç›®å½• (é»˜è®¤: ./filedir)
  -l, --log-level <level>  æ—¥å¿—çº§åˆ« (debug|info|warn|error, é»˜è®¤: info)
  -f, --log-file <file>    æ—¥å¿—æ–‡ä»¶è·¯å¾„ (é»˜è®¤: æ§åˆ¶å°è¾“å‡º)
  -c, --config <file>      é…ç½®æ–‡ä»¶è·¯å¾„
  -h, --help               æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
```

### é…ç½®æ–‡ä»¶

åˆ›å»º `server.conf` é…ç½®æ–‡ä»¶ï¼š

```ini
# ç½‘ç»œé…ç½®
port = 8888
bind_address = 0.0.0.0
max_connections = 10000

# çº¿ç¨‹é…ç½®
thread_count = 8
max_queue_size = 10000

# æ–‡ä»¶é…ç½®
document_root = ./filedir
template_dir = ./html
max_file_size = 104857600  # 100MB

# æ—¥å¿—é…ç½®
log_level = info
log_file = /var/log/webserver.log

# æ€§èƒ½é…ç½®
enable_sendfile = true
enable_keepalive = true
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
WebFileServer/
â”œâ”€â”€ src/                    # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ core/              # æ ¸å¿ƒæœåŠ¡å™¨ç±»
â”‚   â”œâ”€â”€ config/            # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ threadpool/        # çº¿ç¨‹æ± å®ç°
â”‚   â”œâ”€â”€ utils/             # å·¥å…·ç±»
â”‚   â”œâ”€â”€ network/           # ç½‘ç»œè¿æ¥ç®¡ç†
â”‚   â”œâ”€â”€ http/              # HTTPåè®®å¤„ç†
â”‚   â”œâ”€â”€ event/             # äº‹ä»¶å¤„ç†
â”‚   â””â”€â”€ file/              # æ–‡ä»¶æ“ä½œ
â”œâ”€â”€ html/                  # HTMLæ¨¡æ¿
â”œâ”€â”€ filedir/               # æ–‡ä»¶å­˜å‚¨ç›®å½•
â”œâ”€â”€ config/                # é…ç½®æ–‡ä»¶ç¤ºä¾‹
â”œâ”€â”€ tests/                 # å•å…ƒæµ‹è¯•
â”œâ”€â”€ docs/                  # æ–‡æ¡£
â”œâ”€â”€ CMakeLists.txt         # CMakeæ„å»ºæ–‡ä»¶
â”œâ”€â”€ Makefile              # ä¼ ç»ŸMakefile
â””â”€â”€ README.md             # é¡¹ç›®è¯´æ˜
```

## ğŸ”§ æ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æµè§ˆå™¨å®¢æˆ·ç«¯   â”‚â”€â”€â”€â”€â”‚  HTTPåè®®é€šä¿¡   â”‚â”€â”€â”€â”€â”‚   WebæœåŠ¡å™¨     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                       â”‚
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚                               â”‚                               â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  ä¸»çº¿ç¨‹     â”‚              â”‚  çº¿ç¨‹æ±      â”‚              â”‚  æ–‡ä»¶ç³»ç»Ÿ   â”‚
                â”‚ (epollç›‘å¬) â”‚              â”‚ (äº‹ä»¶å¤„ç†)  â”‚              â”‚ (æ–‡ä»¶æ“ä½œ)  â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç»„ä»¶

1. **WebServer**: æœåŠ¡å™¨æ ¸å¿ƒç±»ï¼Œç®¡ç†æ•´ä¸ªæœåŠ¡å™¨ç”Ÿå‘½å‘¨æœŸ
2. **ThreadPool**: ç°ä»£åŒ–çº¿ç¨‹æ± ï¼Œæ”¯æŒä»»æ„å¯è°ƒç”¨å¯¹è±¡
3. **ConnectionManager**: è¿æ¥ç®¡ç†å™¨ï¼Œè´Ÿè´£è¿æ¥çš„åˆ›å»ºã€ç®¡ç†å’Œæ¸…ç†
4. **HttpParser**: HTTPåè®®è§£æå™¨ï¼Œæ”¯æŒåˆ†å—è§£æ
5. **Logger**: å¼‚æ­¥æ—¥å¿—ç³»ç»Ÿï¼Œé«˜æ€§èƒ½æ—¥å¿—è®°å½•
6. **EventHandlers**: äº‹ä»¶å¤„ç†å™¨ï¼Œå¤„ç†å„ç§ç½‘ç»œäº‹ä»¶

### è®¾è®¡æ¨¡å¼

- **Reactoræ¨¡å¼**: äº‹ä»¶é©±åŠ¨çš„ç½‘ç»œç¼–ç¨‹
- **RAIIæ¨¡å¼**: èµ„æºè‡ªåŠ¨ç®¡ç†
- **å·¥å‚æ¨¡å¼**: äº‹ä»¶å¤„ç†å™¨åˆ›å»º
- **å•ä¾‹æ¨¡å¼**: å…¨å±€é…ç½®ç®¡ç†
- **è§‚å¯Ÿè€…æ¨¡å¼**: äº‹ä»¶é€šçŸ¥æœºåˆ¶

## ğŸ“Š æ€§èƒ½ç‰¹æ€§

### å¹¶å‘æ€§èƒ½
- **é«˜å¹¶å‘**: æ”¯æŒä¸‡çº§å¹¶å‘è¿æ¥
- **ä½å»¶è¿Ÿ**: äº‹ä»¶é©±åŠ¨ï¼Œå“åº”è¿…é€Ÿ
- **é«˜åå**: é›¶æ‹·è´æ–‡ä»¶ä¼ è¾“
- **å†…å­˜æ•ˆç‡**: æ™ºèƒ½æŒ‡é’ˆç®¡ç†ï¼Œé¿å…å†…å­˜æ³„æ¼

### ä¼˜åŒ–æŠ€æœ¯
- **epollè¾¹ç¼˜è§¦å‘**: å‡å°‘ç³»ç»Ÿè°ƒç”¨
- **sendfileé›¶æ‹·è´**: é«˜æ•ˆæ–‡ä»¶ä¼ è¾“
- **è¿æ¥å¤ç”¨**: HTTP Keep-Aliveæ”¯æŒ
- **å¼‚æ­¥æ—¥å¿—**: ä¸é˜»å¡ä¸»çº¿ç¨‹

## ğŸ”’ å®‰å…¨ç‰¹æ€§

### åŸºç¡€å®‰å…¨
- **è·¯å¾„éªŒè¯**: é˜²æ­¢ç›®å½•éå†æ”»å‡»
- **æ–‡ä»¶ç±»å‹æ£€æŸ¥**: é™åˆ¶ä¸Šä¼ æ–‡ä»¶ç±»å‹
- **å¤§å°é™åˆ¶**: é˜²æ­¢å¤§æ–‡ä»¶æ”»å‡»
- **è¿æ¥é™åˆ¶**: é˜²æ­¢è¿æ¥è€—å°½æ”»å‡»

### å»ºè®®å¢å¼º
- **HTTPSæ”¯æŒ**: SSL/TLSåŠ å¯†ä¼ è¾“
- **ç”¨æˆ·è®¤è¯**: åŸºäºä»¤ç‰Œçš„è®¤è¯
- **è®¿é—®æ§åˆ¶**: åŸºäºè§’è‰²çš„æƒé™ç®¡ç†
- **å®¡è®¡æ—¥å¿—**: è¯¦ç»†çš„æ“ä½œè®°å½•

## ğŸ§ª æµ‹è¯•

### å•å…ƒæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
make test

# è¿è¡Œç‰¹å®šæµ‹è¯•
./tests/test_http_parser
./tests/test_thread_pool
```

### æ€§èƒ½æµ‹è¯•

```bash
# ä½¿ç”¨abè¿›è¡Œå‹åŠ›æµ‹è¯•
ab -n 10000 -c 100 http://localhost:8888/

# ä½¿ç”¨wrkè¿›è¡Œæ€§èƒ½æµ‹è¯•
wrk -t12 -c400 -d30s http://localhost:8888/
```

### å†…å­˜æ£€æŸ¥

```bash
# ä½¿ç”¨valgrindæ£€æŸ¥å†…å­˜æ³„æ¼
valgrind --leak-check=full ./WebFileServer

# ä½¿ç”¨AddressSanitizer
g++ -fsanitize=address -g -o WebFileServer_debug src/*.cpp
./WebFileServer_debug
```

## ğŸ“ˆ ç›‘æ§å’Œè°ƒè¯•

### æ—¥å¿—åˆ†æ

```bash
# æŸ¥çœ‹å®æ—¶æ—¥å¿—
tail -f /var/log/webserver.log

# åˆ†æé”™è¯¯æ—¥å¿—
grep "ERROR" /var/log/webserver.log

# ç»Ÿè®¡è¯·æ±‚æ•°
grep "INFO.*request" /var/log/webserver.log | wc -l
```

### æ€§èƒ½ç›‘æ§

```bash
# æŸ¥çœ‹è¿›ç¨‹çŠ¶æ€
top -p $(pgrep WebFileServer)

# æŸ¥çœ‹ç½‘ç»œè¿æ¥
netstat -anp | grep :8888

# æŸ¥çœ‹æ–‡ä»¶æè¿°ç¬¦ä½¿ç”¨æƒ…å†µ
lsof -p $(pgrep WebFileServer)
```

## ğŸ›£ï¸ å‘å±•è·¯çº¿å›¾

### çŸ­æœŸç›®æ ‡ (v1.1)
- [ ] HTTPSæ”¯æŒ
- [ ] é…ç½®çƒ­é‡è½½
- [ ] æ›´å¤šHTTPæ–¹æ³•æ”¯æŒ
- [ ] å‹ç¼©ä¼ è¾“æ”¯æŒ

### ä¸­æœŸç›®æ ‡ (v1.5)
- [ ] ç”¨æˆ·è®¤è¯ç³»ç»Ÿ
- [ ] æ–‡ä»¶æƒé™ç®¡ç†
- [ ] RESTful API
- [ ] WebSocketæ”¯æŒ

### é•¿æœŸç›®æ ‡ (v2.0)
- [ ] HTTP/2æ”¯æŒ
- [ ] åˆ†å¸ƒå¼éƒ¨ç½²
- [ ] ç¼“å­˜ç³»ç»Ÿ
- [ ] è´Ÿè½½å‡è¡¡

## ğŸ¤ è´¡çŒ®æŒ‡å—

### å¼€å‘ç¯å¢ƒè®¾ç½®

```bash
# å®‰è£…å¼€å‘ä¾èµ–
sudo apt-get install build-essential cmake git

# å®‰è£…ä»£ç æ ¼å¼åŒ–å·¥å…·
sudo apt-get install clang-format

# å®‰è£…é™æ€åˆ†æå·¥å…·
sudo apt-get install cppcheck clang-tidy
```

### ä»£ç è§„èŒƒ

- ä½¿ç”¨C++17æ ‡å‡†
- éµå¾ªGoogle C++ä»£ç è§„èŒƒ
- ä½¿ç”¨clang-formatæ ¼å¼åŒ–ä»£ç 
- ç¼–å†™å•å…ƒæµ‹è¯•
- æ·»åŠ è¯¦ç»†æ³¨é‡Š

### æäº¤æµç¨‹

1. Forké¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯
3. ç¼–å†™ä»£ç å’Œæµ‹è¯•
4. è¿è¡Œæ‰€æœ‰æµ‹è¯•
5. æäº¤Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ï¼Œè¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## ğŸ‘¥ ä½œè€…

- **ä¸»è¦å¼€å‘è€…**: [Your Name](mailto:your.email@example.com)
- **è´¡çŒ®è€…**: æŸ¥çœ‹ [CONTRIBUTORS.md](CONTRIBUTORS.md)

## ğŸ™ è‡´è°¢

æ„Ÿè°¢ä»¥ä¸‹é¡¹ç›®å’Œèµ„æºçš„å¯å‘ï¼š

- [TinyWebServer](https://github.com/qinguoyi/TinyWebServer)
- [muduoç½‘ç»œåº“](https://github.com/chenshuo/muduo)
- [nginx](https://nginx.org/)
- ã€ŠLinuxé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹ã€‹
- ã€ŠTCP/IPç½‘ç»œç¼–ç¨‹ã€‹

## ğŸ“ æ”¯æŒ

å¦‚æœæ‚¨é‡åˆ°é—®é¢˜æˆ–æœ‰å»ºè®®ï¼Œè¯·ï¼š

1. æŸ¥çœ‹ [FAQ](docs/FAQ.md)
2. æœç´¢ [Issues](https://github.com/your-repo/WebFileServer/issues)
3. åˆ›å»ºæ–°çš„Issue
4. å‘é€é‚®ä»¶è‡³ support@webserver.com

---

**WebFileServer** - ç°ä»£C++æ„å»ºçš„é«˜æ€§èƒ½Webæ–‡ä»¶æœåŠ¡å™¨ ğŸš€